#!/bin/bash
# Author name: Ruel Nopal
# Company: RaketHost PH Inc.
# url: www.rakethost.ph

# move wp-content and wp-config.php to temporary folder /etc
mv wp-content /etc/wp-content
mv wp-config.php /etc/wp-config.php

# Check current user
current_user=$(stat -c %U /etc/wp-config.php)

# Delete all other files and folder after moving wp-content
find /home/$current_user/public_html/* ! -name 'wp_malware_cleaner.sh' -delete

# Download Latest WordPress Files.
wget https://wordpress.org/latest.zip

# Unzip WorPress Files
unzip latest.zip

# Change user base on the user
chown -R $current_user:$current_user wordpress

# move unzip files to the root folder
mv wordpress/* /home/$current_user/public_html/

# Delete wordpress downloaded zip and and uncompress zip
rm -rf latest.zip
rm -rf wordpress

# Delete wp-content
rm -rf wp-content

# Move back the wp-content and wp-config back to root folder from etc folder
mv /etc/wp-content /home/$current_user/public_html/wp-content
mv /etc/wp-config.php /home/$current_user/public_html/wp-config.php
